# tests/unit/vulnerability/test_scanner.py
import pytest
from unittest.mock import patch, MagicMock
import sys
from pathlib import Path

# Add project root to Python path
sys.path.insert(0, str(Path(__file__).parent.parent.parent.parent))

from modules.vulnerability_scanning.scanner import VulnScanner

class TestVulnScanner:
    @pytest.fixture
    def scanner(self):
        return VulnScanner("http://test.com")

    @patch('subprocess.run')
    def test_sqlmap_success(self, mock_run, scanner):
        mock_run.return_value = MagicMock(returncode=0)
        assert scanner.run_sqlmap() is True

    @patch('modules.xss.scanner.XSSScanner.scan')
    def test_xss_scan(self, mock_xss, scanner):
        mock_xss.return_value = ["XSS found"]
        assert scanner.check_xss() == ["XSS found"]